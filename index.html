<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>XMA Store</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/near-api-js@2.1.4/dist/near-api-js.min.js"></script>
        <!-- Настройка конфигурации Tailwind для темной темы по умолчанию -->
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            'dark-bg': '#010101',
                            'dark-card': '#212020',
                            'dark-gradient-end': '#190038',
                            'purple-border': '#414141', // custom border color
                        }
                    }
                }
            }
        </script>
    </head>
    <body class="min-h-screen flex flex-col items-center justify-start pt-24 bg-dark-bg bg-gradient-to-br from-dark-bg to-dark-gradient-end text-white">
        <div class="flex flex-col w-full max-w-md p-6 rounded-xl shadow-lg bg-dark-card space-y-4 border-2 border-purple-border">

            <!-- Первая строка: Full Time Develop и $1,000,000 -->
            <div class="flex justify-between items-center text-xl font-semibold">
                <span class="text-gray-400">FULL-TIME DEVELOPMENT</span>
                <span class="text-xl font-bold text-green-400">1 000 000 $</span>
            </div>

            <div class="relative w-full bg-gray-700 rounded-full h-12 overflow-hidden border-2 border-purple-border">
                <div id="loader" class="bg-yellow-600 h-full loaderStyle"></div>

                <!-- Текст внутри шкалы -->
                <div class="absolute inset-0 flex justify-between items-center px-4 text-base font-medium">
                    <span class="drop-shadow-[0_0_5px_rgba(0,0,0,1)]">RAISED IN <span id="raisedCount" class="text-xl text-green-400"></span> NEAR</span>
                    <span>GOAL: <span id="raisedNeed" class="text-xl text-green-400"></span> NEAR</span>
                </div>
            </div>

            <div class="flex items-center">
                <div class="flex-grow bg-gray-700/50 p-3 rounded-lg flex items-center justify-center border-2 border-purple-border">
                    <span class="text-xl font-mono truncate">xmastore.near</span>
                </div>
                <button onclick="navigator.clipboard.writeText('xmastore.near')" class="ml-6 px-4 py-2 bg-red-600 text-white font-semibold rounded-lg shadow-md hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 transition duration-150 ease-in-out">
                    COPY
                </button>
                <div id="toast-container" style="position: fixed; top: 300px; right: 45%"></div>
            </div>
        </div>
    </body>
    <!-- Небольшой скрипт для обработки копирования -->
    <script>

        document.querySelector('button').addEventListener('click', () => {
            //alert('Адрес скопирован!');
            showToast('Address copied!', 700);
        });
        function showToast(message, duration) {
            const toastContainer = document.getElementById('toast-container');
            const toastElement = document.createElement('div');
            toastElement.className = 'toast'; // Для стилизации
            toastElement.textContent = message;
            toastElement.style.padding = '10px';
            toastElement.style.backgroundColor = '#333';
            toastElement.style.color = 'white';
            toastElement.style.borderRadius = '5px';
            toastElement.style.marginBottom = '10px';
            toastElement.style.opacity = '0'; // Начальное состояние для анимации
            toastElement.style.transition = 'opacity 0.3s ease-in-out';

            toastContainer.appendChild(toastElement);

            // Показываем (плавно)
            setTimeout(() => {
                toastElement.style.opacity = '1';
            }, 10); // Небольшая задержка, чтобы transition сработал

            // Скрываем через 500ms
            setTimeout(() => {
                toastElement.style.opacity = '0';
                // Удаляем элемент из DOM после завершения анимации
                setTimeout(() => {
                    toastElement.remove();
                }, 300); // Ждем завершения fade-out
            }, duration);
        }

        async function updateNearBalance() {
            // Настройки сети (mainnet или testnet)
            const config = {
                networkId: "mainnet",
                nodeUrl: "https://rpc.mainnet.near.org",
                walletUrl: "https://wallet.near.org",
                helperUrl: "https://helper.mainnet.near.org",
                explorerUrl: "https://explorer.near.org",
            };

            // ID кошелька, баланс которого нужно получить
            const accountId = "xmastore.near";

            try {
                // 1. Подключаемся к сети
                const near = await nearApi.connect(config);

                // 2. Получаем объект аккаунта
                const account = await near.account(accountId);

                // 3. Получаем состояние аккаунта (включая баланс)
                const balance = await account.getAccountBalance();

                // 4. Конвертируем из YoctoNEAR в NEAR (1 NEAR = 10^24 YoctoNEAR)
                // Используем встроенный метод форматирования
                const amountInNear = nearApi.utils.format.formatNearAmount(balance.available, 0);

                // 5. Записываем результат в элемент
                const element = document.getElementById('raisedCount');
                if (element) {
                    element.innerText = amountInNear;
                }
                await getNearPrice();

            } catch (error) {
                console.error("Ошибка при получении баланса NEAR:", error);
                document.getElementById('raisedCount').innerText = "0";
            }
        }

        // Выполняем функцию при загрузке окна
        window.addEventListener('load', updateNearBalance);

        async function getNearPrice() {
            try {
                // Запрос к публичному API Binance для пары NEAR/USDT
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=near&vs_currencies=usd&include_market_cap=true&include_24hr_vol=true&include_24hr_change=true');
                const data = await response.json();

                // Цена возвращается в виде строки, преобразуем в число
                const maxCount = parseFloat(1000000.00).toFixed(2);
                let price = parseFloat(data.near.usd).toFixed(2);
                price = maxCount / price
                price = parseFloat(price).toFixed(0);

                // Вставляем в ваш элемент (из предыдущего вопроса)
                const raisedCount = document.getElementById('raisedCount');
                const loader = document.getElementById('loader');
                if (loader) {
                    loader.style.width = getPercentage(raisedCount.innerText, price) + '%';
                }

                price = formatNumberWithSpaces(price);

                const element = document.getElementById('raisedNeed');
                if (element) {
                    element.innerText = price;
                }

                return price;
            } catch (error) {
                console.error("Ошибка при получении цены:", error);
                return null;
            }
        }
        function formatNumberWithSpaces(number) {
            return new Intl.NumberFormat('en-EN', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 20
            }).format(number);
        }
        function getPercentage(part, total, decimals = 2) {
            if (total === 0) return '0';

            const percentage = (part / total) * 100;

            return percentage.toFixed(decimals);
        }
    </script>
    <style>
        .loaderStyle {
            width: 0;
            transition: width 2s ease-in-out;
        }
        .loaderStyle.animated  {
            transition: width 2s cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</html>
