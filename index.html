<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>XMA Store</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script src="https://cdn.jsdelivr.net/npm/near-api-js@2.1.4/dist/near-api-js.min.js"></script>
        <!-- Настройка конфигурации Tailwind для темной темы по умолчанию -->
        <script>
            tailwind.config = {
                theme: {
                    extend: {
                        colors: {
                            'dark-bg': '#010101',
                            'dark-card': '#212020',
                            'dark-gradient-end': '#2f2c11',
                            'purple-border': '#414141', // custom border color
                        }
                    }
                }
            }
        </script>
    </head>
    <body class="relative min-h-screen w-full flex flex-col items-center justify-start pt-24 pb-12 text-white antialiased">

        <!-- Фиксированный фон, который не ломается при скролле -->
        <div class="fixed inset-0 -z-10 h-full w-full bg-[#1a1b1e] bg-gradient-to-br from-[#2a2929] to-[#1a1b1e]"></div>

        <!-- Логотип (адаптивное позиционирование) -->
        <div class="absolute sm:fixed left-5 top-5 z-20">
            <div class="relative w-24 sm:w-32 h-12 sm:h-16 flex items-center justify-center">
                <img src="logo.svg" alt="Logo" class="max-h-full">
            </div>
        </div>

        <!-- Кнопка GitHub (скрываем текст на мобильных для экономии места) -->
        <div class="absolute sm:fixed right-5 top-5 z-20">
            <a href="https://github.com/xmastorenear" target="_blank" rel="noopener noreferrer"
               class="relative group flex items-center justify-center p-2 rounded-xl bg-[#1a1b1e]/80 backdrop-blur-md border border-white/10 shadow-xl transition-all hover:border-amber-500/50 active:scale-95">
                <img src="github.svg" alt="GitHub" class="w-8 h-8 sm:w-10 sm:h-10 relative z-10 group-hover:brightness-125">
                <span class="hidden sm:block max-w-0 overflow-hidden whitespace-nowrap text-white font-bold text-xs uppercase tracking-widest transition-all duration-500 group-hover:max-w-xs group-hover:ml-3 group-hover:pr-2">
                    GitHub
                </span>
            </a>
        </div>

        <!-- Первый блок (Progress) -->
        <div class="flex flex-col w-[92%] sm:w-[448px] p-6 rounded-2xl shadow-2xl bg-[#1a1b1e] space-y-5 border border-amber-500/30 backdrop-blur-sm mb-[5px]">
            <div class="flex justify-between items-end">
                <div class="flex flex-col">
                    <span class="text-[10px] font-bold text-amber-500 uppercase tracking-[0.2em]">Status</span>
                    <span class="text-gray-200 font-bold text-sm sm:text-lg uppercase">Full-time Dev</span>
                </div>
                <div class="text-right">
                    <span class="block text-[10px] font-bold text-gray-500 uppercase">Target</span>
                    <span class="text-xl sm:text-2xl font-black text-green-400">$1,000,000</span>
                </div>
            </div>

            <div class="relative w-full bg-black/40 rounded-xl h-12 sm:h-14 overflow-hidden border border-amber-500/20 shadow-inner">
                <div id="loader" class="bg-gradient-to-r from-amber-700 via-yellow-500 to-amber-400 h-full relative">
                    <div class="absolute inset-0 bg-white/20 skew-x-[-20px] translate-x-[-100%] animate-[shimmer_2s_infinite]"></div>
                </div>
                <div class="absolute inset-0 flex justify-between items-center px-4 text-[11px] sm:text-[13px] font-bold text-white uppercase">
                    <span>Raised: <span id="raisedCount" class="text-sm"></span> NEAR</span>
                    <span>Goal: <span id="raisedNeed" class="text-sm"></span> NEAR</span>
                </div>
            </div>

            <div class="flex items-center gap-2 sm:gap-3 pt-2">
                <div class="flex-grow bg-black/30 p-3 rounded-xl border border-white/5 overflow-hidden">
                    <code class="text-xs sm:text-sm font-mono text-gray-300 truncate block">xmastore.near</code>
                </div>
                <button onclick="navigator.clipboard.writeText('xmastore.near')"
                        class="px-4 sm:px-6 py-3 bg-red-600 hover:bg-red-500 text-white font-bold text-[10px] sm:text-xs rounded-xl transition-all active:scale-95 shadow-lg uppercase tracking-widest">
                    Copy
                </button>
                <div id="toast-container" style="position: fixed; top: 250px; right: 50%"></div>
            </div>
        </div>

        <!-- Второй блок (Giveaway) -->
        <div class="w-[92%] sm:w-[448px] bg-gradient-to-b from-[#2a2929] to-[#1a1b1e] flex flex-col items-center justify-center rounded-[20px] mt-8 sm:mt-12 border border-amber-500/30 gap-5 pb-8 shadow-2xl">
            <div class="mt-6 text-center">
                <span class="text-xl sm:text-2xl font-black tracking-tight bg-clip-text text-transparent bg-gradient-to-r from-amber-200 via-yellow-400 to-amber-500 uppercase">
                    Enter the Giveaway
                </span>
            </div>

            <div class="w-[90%]">
                <label class="block mb-1.5 text-[10px] font-bold text-amber-500/80 uppercase tracking-[0.2em] ml-1 text-left w-full">Near address</label>
                <input type="text" class="bg-[#1a1a1a] border border-white/10 text-white text-sm rounded-xl focus:ring-2 focus:ring-amber-500 block w-full px-4 py-3 outline-none" placeholder="John.near">
            </div>

            <div class="w-[90%]">
                <label class="block mb-1.5 text-[10px] font-bold text-amber-500/80 uppercase tracking-[0.2em] ml-1 text-left w-full">X address</label>
                <input type="text" class="bg-[#1a1a1a] border border-white/10 text-white text-sm rounded-xl focus:ring-2 focus:ring-amber-500 block w-full px-4 py-3 outline-none" placeholder="@John">
            </div>

            <div class="w-[90%] mt-2">
                <button class="w-full bg-gradient-to-r from-amber-600 to-yellow-500 text-black font-black text-xs py-4 rounded-xl shadow-lg active:scale-[0.97] transition-all uppercase tracking-widest">
                    Send Entry
                </button>
            </div>
        </div>
    </body>
    <!-- Небольшой скрипт для обработки копирования -->
    <script>

        document.querySelector('button').addEventListener('click', () => {
            showToast('Address copied!', 700);
        });
        function showToast(message, duration) {
            const toastContainer = document.getElementById('toast-container');
            const toastElement = document.createElement('div');
            toastElement.className = 'toast'; // Для стилизации
            toastElement.textContent = message;
            toastElement.style.padding = '10px';
            toastElement.style.backgroundColor = '#333';
            toastElement.style.color = 'white';
            toastElement.style.borderRadius = '5px';
            toastElement.style.marginBottom = '10px';
            toastElement.style.opacity = '0'; // Начальное состояние для анимации
            toastElement.style.transition = 'opacity 0.3s ease-in-out';

            toastContainer.appendChild(toastElement);

            // Показываем (плавно)
            setTimeout(() => {
                toastElement.style.opacity = '1';
            }, 10); // Небольшая задержка, чтобы transition сработал

            // Скрываем через 500ms
            setTimeout(() => {
                toastElement.style.opacity = '0';
                // Удаляем элемент из DOM после завершения анимации
                setTimeout(() => {
                    toastElement.remove();
                }, 300); // Ждем завершения fade-out
            }, duration);
        }

        async function updateNearBalance() {
            // Настройки сети (mainnet или testnet)
            const config = {
                networkId: "mainnet",
                nodeUrl: "https://rpc.mainnet.near.org",
                walletUrl: "https://wallet.near.org",
                helperUrl: "https://helper.mainnet.near.org",
                explorerUrl: "https://explorer.near.org",
            };

            // ID кошелька, баланс которого нужно получить
            const accountId = "xmastore.near";

            try {
                // 1. Подключаемся к сети
                const near = await nearApi.connect(config);

                // 2. Получаем объект аккаунта
                const account = await near.account(accountId);

                // 3. Получаем состояние аккаунта (включая баланс)
                const balance = await account.getAccountBalance();

                // 4. Конвертируем из YoctoNEAR в NEAR (1 NEAR = 10^24 YoctoNEAR)
                // Используем встроенный метод форматирования
                const amountInNear = nearApi.utils.format.formatNearAmount(balance.available, 0);

                // 5. Записываем результат в элемент
                const element = document.getElementById('raisedCount');
                if (element) {
                    element.innerText = amountInNear;
                }
                await getNearPrice();

            } catch (error) {
                console.error("Ошибка при получении баланса NEAR:", error);
                document.getElementById('raisedCount').innerText = "0";
            }
        }

        // Выполняем функцию при загрузке окна
        window.addEventListener('load', updateNearBalance);

        async function getNearPrice() {
            try {
                // Запрос к публичному API Binance для пары NEAR/USDT
                const response = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=near&vs_currencies=usd&include_market_cap=true&include_24hr_vol=true&include_24hr_change=true');
                const data = await response.json();

                // Цена возвращается в виде строки, преобразуем в число
                const maxCount = parseFloat(1000000.00).toFixed(2);
                let price = parseFloat(data.near.usd).toFixed(2);
                price = maxCount / price
                price = parseFloat(price).toFixed(0);

                // Вставляем в ваш элемент (из предыдущего вопроса)
                const raisedCount = document.getElementById('raisedCount');
                const loader = document.getElementById('loader');
                if (loader) {
                    loader.style.width = getPercentage(raisedCount.innerText, price) + '%';
                }

                price = formatNumberWithSpaces(price);

                const element = document.getElementById('raisedNeed');
                if (element) {
                    element.innerText = price;
                }

                return price;
            } catch (error) {
                console.error("Ошибка при получении цены:", error);
                return null;
            }
        }
        function formatNumberWithSpaces(number) {
            return new Intl.NumberFormat('en-EN', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 20
            }).format(number);
        }
        function getPercentage(part, total, decimals = 2) {
            if (total === 0) return '0';

            const percentage = (part / total) * 100;

            return percentage.toFixed(decimals);
        }
    </script>
    <style>

        @keyframes shimmer { 100% { transform: translateX(200%); } }
        /* Исправление для iOS: динамическая высота */
        @supports (-webkit-touch-callout: none) { .min-h-screen { min-h: -webkit-fill-available; } }
    </style>
</html>
